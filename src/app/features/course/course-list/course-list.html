<div class="page-container">
  <!-- Header -->
  <header class="page-header">
    <!-- Left Side: Title & Subtitle -->
    <div>
      <h1 class="heading-txt">Course List</h1>
      <p class="content-text">
        Create and manage courses for your organization
      </p>
    </div>

    <!-- Right Side: Back Button -->
    <div class="ml-auto">
      @if(permissions.showAddCourseButton) {
      <button type="button" (click)="addcourse()" class="btn-primary group">
        <span class="w-[1em] h-[1em]">
          <svg class="w-full h-full group-hover:animate-pump" viewBox="0 0 24 24" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <g id="Edit / Add_Plus">
              <path id="Vector" d="M6 12H12M12 12H18M12 12V18M12 12V6" stroke="currentColor" stroke-width="3"
                stroke-linecap="round" stroke-linejoin="round" />
            </g>
          </svg>
        </span>
        <span>Add Course</span>
      </button>
      }
    </div>
  </header>

  <section class="page-content">
    @if(permissions.showTenantDropdown || selectedCourses.length >0){
    <div class="flex items-center card">
      @if(permissions.showTenantDropdown){
      <div class="flex items-end gap-4">
        <div class="min-w-40">
          <label class="block mb-2 text-sm text-gray-900">Tenant</label>
          <select class="form-select" [(ngModel)]="selectedTenantId" (change)="filterByTenant(selectedTenantId)">
            @for(tenant of tenantlist; track $index) {
            <option [value]="tenant.tenantId">
              {{ tenant.tenantName }}
            </option>
            }
          </select>
        </div>
      </div>
      }

      <div class="ml-auto flex items-center gap-4">
        @if(selectedCourses.length > 0 ){
        @if(selectedTenantId == "1" && permissions.showTenantDropdown) {
        <button type="button" (click)="openTenant()"
          class="bg-primary-600 text-white text-sm font-semibold px-4 py-2 rounded-lg hover:bg-primary-800 cursor-pointer">
          Assign To Tenant
        </button>
        }
        }
        @if(selectedCourses.length > 0) {
        <button type="button" (click)="openDepartment()"
          class="bg-primary-600 text-white text-sm font-semibold px-4 py-2 rounded-lg hover:bg-primary-800 cursor-pointer">
          Assign Departments
        </button>
        }
      </div>
    </div>
    }

    @if(courses.length > 0){
    <div class="grid md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4">
      @for (course of courses; track course.courseId) {
      <div
        class="group grid grid-rows-[auto_1fr] relative bg-white border border-transparent rounded-lg shadow transition-shadow duration-300 has-checked:border-primary-500 has-checked:backdrop-blur-lg has-checked:shadow-[0px_0px_0px_1px_rgba(0,0,0,0.06),0px_1px_1px_-0.5px_rgba(0,0,0,0.06),0px_3px_3px_-1.5px_rgba(0,0,0,0.06),_0px_6px_6px_-3px_rgba(0,0,0,0.06),0px_12px_12px_-6px_rgba(0,0,0,0.06),0px_24px_24px_-12px_rgba(0,0,0,0.06)]">
        <div class="relative w-full aspect-video bg-slate-200 rounded-t-lg overflow-hidden">
          <img [src]="course.thumbnailUrl" alt="{{ course.courseName }}" (error)="onImgError($event)"
            class="max-w-full w-full object-cover" />
        </div>
        <div class="grid grid-rows-[1fr_auto_auto] p-4">
          <h3 class="text-md 2xl:text-lg font-semibold text-gray-800 group-has-checked:text-primary-500">
            {{ course.courseName }}
          </h3>
          <p class="flex items-center gap-2.5 text-sm text-gray-500 mt-1 group-has-checked:text-primary-400">
            <span>Duration: {{ course.duration }}</span>
            @if(course.isPackage == true){
            <span class="inline-block w-1.5 h-1.5 rounded-full bg-gray-400"></span>
            <span title="Package Course" class="inline-block w-5 h-5">
              <svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg" class="w-full fill-gray-500">
                <path
                  d="M226.40478,72.71875c-.012-.02246-.01758-.0459-.03-.06836l-.01342-.01855a11.98985,11.98985,0,0,0-4.47876-4.41211l-88-49.5a12.06937,12.06937,0,0,0-11.76563,0l-88,49.5a11.99943,11.99943,0,0,0-4.48492,4.4248c-.00531.00977-.01276.0166-.018.02637-.01343.02392-.01916.0498-.032.07373a11.98451,11.98451,0,0,0-1.58222,5.93408v98.64258a12.01654,12.01654,0,0,0,6.11719,10.459l88,49.5a11.97648,11.97648,0,0,0,5.61182,1.51368c.08325.00585.16211.02636.24658.02734h.03613c.10059,0,.19507-.022.29395-.0293a11.97814,11.97814,0,0,0,5.57715-1.51172l88-49.5a12.01422,12.01422,0,0,0,6.11718-10.459V78.67871A11.98628,11.98628,0,0,0,226.40478,72.71875Zm-100.366-47.02637a4.02315,4.02315,0,0,1,3.92187,0l85.91113,48.3252L177.1521,96.01465,88.22,46.96582Zm2.89062,97.71826L40.18921,73.98291,80.019,51.57861l88.97339,49.07178Zm-90.89062,57.397a4.00512,4.00512,0,0,1-2.03907-3.48633V80.80615l88.92835,49.53272-.86853,98.85547Zm179.92187,0-85.8999,48.31884.86792-98.7871,40.0935-22.77784v44.94922a4,4,0,0,0,8,0V103.0166l38.97754-22.14355v96.44824A4.00455,4.00455,0,0,1,217.96069,180.80762Z" />
              </svg>
            </span>
            }
          </p>
          <div class="mt-4 flex items-center gap-2">
            <label title="Select Course"
              class="relative flex justify-center items-center gap-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg hover:border-primary-500 hover:text-primary-500 focus:text-primary-500 focus:ring-primary-500 focus:border-primary-500 has-checked:bg-gray-50 has-checked:border-primary-500 has-checked:text-primary-500 w-8 h-8 cursor-pointer">
              <input type="checkbox" [checked]="course.isSelected || false"
                (change)="toggleCourseSelection(course, $event)" class="sr-only" />
              @if (course.isSelected) {
              <!-- <span>Selected</span> -->
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 stroke-primary-500" fill="none"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>

              } @else {
              <!-- <span>Select</span> -->
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 stroke-gray-500">
                <g id="Edit / Add_Plus">
                  <path id="Vector" d="M6 12H12M12 12H18M12 12V18M12 12V6" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round"></path>
                </g>
              </svg>
              }
            </label>
            <div class="ml-auto relative dropdown-container">
              <button title="Action" (click)="toggleDropdown(course.courseId)"
                class="flex justify-center items-center rounded-lg border border-gray-300 hover:border-primary-500 mx-auto w-8 h-8 bg-gray-50 hover:bg-gray-100 cursor-pointer transition duration-700">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                  class="w-6 h-6 stroke-gray-500 hover:stroke-primary-500">
                  <path
                    d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  <path
                    d="M12 6C12.5523 6 13 5.55228 13 5C13 4.44772 12.5523 4 12 4C11.4477 4 11 4.44772 11 5C11 5.55228 11.4477 6 12 6Z"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  <path
                    d="M12 20C12.5523 20 13 19.5523 13 19C13 18.4477 12.5523 18 12 18C11.4477 18 11 18.4477 11 19C11 19.5523 11.4477 20 12 20Z"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
              </button>
              @if(openDropdownId === course.courseId){
              <div
                class="text-sm text-gray-500 absolute right-0 top-full mt-1 w-32 bg-gray-50 border border-gray-300 rounded-lg shadow-lg z-20 *:cursor-pointer">
                @if(course.isPackage == false){
                <button (click)="openPreview(course); closeDropdown()"
                  class="block w-full text-left px-4 py-2 hover:bg-gray-200 hover:text-gray-900 first:rounded-t-lg last:rounded-b-lg">
                  Preview
                </button>
                }
                <button (click)="editCourse(course.courseId); closeDropdown()"
                  class="block w-full text-left px-4 py-2 hover:bg-gray-200 hover:text-gray-900">
                  Edit
                </button>
                <button (click)="deleteCourse(course.courseId); closeDropdown()"
                  class="block w-full text-left text-red-500 px-4 py-2 hover:bg-red-100 hover:text-red-600 first:rounded-t-lg last:rounded-b-lg">
                  Delete
                </button>
              </div>
              }
            </div>
          </div>
        </div>
      </div>
      }
    </div>
    } @else if(loading){
    <div
      class="grid place-content-center bg-white p-4 rounded-lg shadow-sm text-center text-gray-600 py-10 grow shrink-0 basis-[0%] h-full max-h-full">
      <div class="grid gap-4 items-center">
        <div class="grid items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 782.04441 701.88002"
            xmlns:xlink="http://www.w3.org/1999/xlink" role="img" class="w-40 fill-primary-500">
            <path
              d="M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z"
              transform="translate(-208.9778 -99.05999)" fill="#f2f2f2" />
            <path
              d="M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z"
              transform="translate(-208.9778 -99.05999)" fill="#fff" />
            <path
              d="M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z"
              transform="translate(-208.9778 -99.05999)" fill="#f2f2f2" />
            <path
              d="M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z"
              transform="translate(-208.9778 -99.05999)" fill="#f2f2f2" />
            <path
              d="M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z"
              transform="translate(-208.9778 -99.05999)" fill="#f2f2f2" />
            <path
              d="M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z"
              transform="translate(-208.9778 -99.05999)" fill="#f2f2f2" />
            <path
              d="M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z"
              transform="translate(-208.9778 -99.05999)" fill="#f2f2f2" />
            <path
              d="M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z"
              transform="translate(-208.9778 -99.05999)" fill="#f2f2f2" />
            <path
              d="M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z"
              transform="translate(-208.9778 -99.05999)" fill="#e6e6e6" />
            <path
              d="M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z"
              transform="translate(-208.9778 -99.05999)" fill="#e6e6e6" />
            <path
              d="M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z"
              transform="translate(-208.9778 -99.05999)" fill="#e6e6e6" />
            <path
              d="M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z"
              transform="translate(-208.9778 -99.05999)" fill="#e6e6e6" />
            <path
              d="M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z"
              transform="translate(-208.9778 -99.05999)" fill="#fff" />
            <circle cx="694.19401" cy="614.02963" r="87.85039" />
            <path
              d="M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z"
              transform="translate(-208.9778 -99.05999)" fill="#fff" />
            <path
              d="M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z"
              transform="translate(-208.9778 -99.05999)" fill="#e6e6e6" />
            <path
              d="M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z"
              transform="translate(-208.9778 -99.05999)" fill="#e6e6e6" />
            <path
              d="M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z"
              transform="translate(-208.9778 -99.05999)" fill="#e6e6e6" />
            <path
              d="M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z"
              transform="translate(-208.9778 -99.05999)" fill="#e6e6e6" />
            <path
              d="M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z"
              transform="translate(-208.9778 -99.05999)" fill="#e6e6e6" />
            <path
              d="M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z"
              transform="translate(-208.9778 -99.05999)" fill="#e6e6e6" />
            <path
              d="M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z"
              transform="translate(-208.9778 -99.05999)" fill="#ccc" />
            <path
              d="M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z"
              transform="translate(-208.9778 -99.05999)" fill="#ccc" />
            <path
              d="M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z"
              transform="translate(-208.9778 -99.05999)" />
          </svg>
        </div>
        <div class="grid gap-2">
          <p class="text-xl font-semibold">No Courses found.</p>
          <p class="text-sm text-center">
            There are no Courses available at the moment. <br />Click "Add
            Course" to create a new Course.
          </p>
        </div>
      </div>
    </div>
    }
  </section>
</div>

<!-- Delete Popup -->
<app-popup [config]="popupConfig" (closeEvent)="closePopup()" (buttonClick)="handlePopupAction($event)">
  <ng-container>
    @if (popupConfig.popupFunctionalityType === 'delete') {
    <app-delete-course #deletecourse [courseId]="selectedCourseId" (close)="closePopup()"
      (deleted)="onCourseDeleted()"></app-delete-course>
    } @if (popupConfig.popupFunctionalityType === 'department') {
    <app-assign-courses-to-department #assigncourse [Courses]="selectedCourses" [TenantId]="selectedTenantId"
      (close)="closePopup()"></app-assign-courses-to-department>
    } @if (popupConfig.popupFunctionalityType === 'tenant') {
    <app-assign-courses-to-tenant #assigncoursetenant [Courses]="selectedCourses"
      (close)="closePopup()"></app-assign-courses-to-tenant>
    } @if (popupConfig.popupFunctionalityType === 'preview') {
    <app-preview-course #previewcourse [previewurl]="selectedPreviewUrl" (close)="closePopup()"></app-preview-course>
    }
    @if (popupConfig.popupFunctionalityType === 'tocpreview') {
    <app-toc-preview-popup #tocpreview [curriculumId]="curriculumId" (close)="closePopup()">
    </app-toc-preview-popup>
    }
  </ng-container>
</app-popup>