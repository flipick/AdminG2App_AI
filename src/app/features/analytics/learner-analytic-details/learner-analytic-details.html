<div class="grid gap-4">
    <section>
        <div class="flex items-end gap-4">
            <div class="min-w-40">
                <label class="block mb-2 text-sm text-gray-900">Search Learners</label>
                <input type="text" class="form-input" id="learnerSearch" placeholder="Search by name or email..." (input)="onSearch($event)">
            </div>
            <div class="min-w-40">
                <label class="block mb-2 text-sm text-gray-900">Department</label>
                <select class="form-select" [(ngModel)]="selectedDepartmentId"
                    (change)="filterByDepartment(selectedDepartmentId)">
                    <option value="0" selected>All Departments</option>
                    @for(department of departmentList; track $index) {
                    <option [value]="department.departmentId">
                        {{ department.departmentName }}
                    </option>
                    }
                </select>
            </div>
        </div>
    </section>
    <div class="grid gap-4">
        <!-- Executive Summary Cards -->
        <section class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
            <div class="grid grid-cols-[60px_1fr] items-center gap-6 bg-primary-50 border border-gray-300 text-gray-900 rounded-lg shadow-sm p-2.5">
                <div class="flex justify-center items-center aspect-square rounded-lg">
                    <svg class="w-[70%] fill-primary-500/60" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
        viewBox="0 0 512 512"  xml:space="preserve">
                        <g>
                            <path class="st0" d="M505.837,180.418L279.265,76.124c-7.349-3.385-15.177-5.093-23.265-5.093c-8.088,0-15.914,1.708-23.265,5.093
                                L6.163,180.418C2.418,182.149,0,185.922,0,190.045s2.418,7.896,6.163,9.627l226.572,104.294c7.349,3.385,15.177,5.101,23.265,5.101
                                c8.088,0,15.916-1.716,23.267-5.101l178.812-82.306v82.881c-7.096,0.8-12.63,6.84-12.63,14.138c0,6.359,4.208,11.864,10.206,13.618
                                l-12.092,79.791h55.676l-12.09-79.791c5.996-1.754,10.204-7.259,10.204-13.618c0-7.298-5.534-13.338-12.63-14.138v-95.148
                                l21.116-9.721c3.744-1.731,6.163-5.504,6.163-9.627S509.582,182.149,505.837,180.418z"/>
                            <path class="st0" d="M256,346.831c-11.246,0-22.143-2.391-32.386-7.104L112.793,288.71v101.638
                                c0,22.314,67.426,50.621,143.207,50.621c75.782,0,143.209-28.308,143.209-50.621V288.71l-110.827,51.017
                                C278.145,344.44,267.25,346.831,256,346.831z"/>
                        </g>
                    </svg>
                </div>
                <div>
                    <label class="text-xs text-primary-500/80">Active Learners</label>
                    <p class="text-4xl font-bold text-primary-500">{{ totalLearners }}</p>
                </div>
            </div>

            <div class="grid grid-cols-[60px_1fr] items-center gap-6 bg-primary-50 border border-gray-300 text-gray-900 rounded-lg shadow-sm p-2.5">
                <div class="flex justify-center items-center aspect-square rounded-lg">
                    <svg class="w-[70%] fill-primary-500/60" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 2a.5.5 0 0 1 .5.5V4a.5.5 0 0 1-1 0V2.5A.5.5 0 0 1 8 2zM3.732 3.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 8a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 8zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 7.31A.91.91 0 1 0 8.85 8.569l3.434-4.297a.389.389 0 0 0-.029-.518z"/>
                        <path fill-rule="evenodd" d="M6.664 15.889A8 8 0 1 1 9.336.11a8 8 0 0 1-2.672 15.78zm-4.665-4.283A11.945 11.945 0 0 1 8 10c2.186 0 4.236.585 6.001 1.606a7 7 0 1 0-12.002 0z"/>
                    </svg>
                </div>
                <div>
                    <label class="text-xs text-primary-500/80">Avg Progress</label>
                    <p class="text-4xl font-bold text-primary-500">{{ avgProgress }}</p>
                </div>
            </div>

            <div class="grid grid-cols-[60px_1fr] items-center gap-6 bg-primary-50 border border-gray-300 text-gray-900 rounded-lg shadow-sm p-2.5">
                <div class="flex justify-center items-center aspect-square rounded-lg">
                    <svg class="w-[70%] fill-primary-500/60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M12 16C15.866 16 19 12.866 19 9C19 5.13401 15.866 2 12 2C8.13401 2 5 5.13401 5 9C5 12.866 8.13401 16 12 16ZM12 6C11.7159 6 11.5259 6.34084 11.1459 7.02251L11.0476 7.19887C10.9397 7.39258 10.8857 7.48944 10.8015 7.55334C10.7173 7.61725 10.6125 7.64097 10.4028 7.68841L10.2119 7.73161C9.47396 7.89857 9.10501 7.98205 9.01723 8.26432C8.92945 8.54659 9.18097 8.84072 9.68403 9.42898L9.81418 9.58117C9.95713 9.74833 10.0286 9.83191 10.0608 9.93531C10.0929 10.0387 10.0821 10.1502 10.0605 10.3733L10.0408 10.5763C9.96476 11.3612 9.92674 11.7536 10.1565 11.9281C10.3864 12.1025 10.7318 11.9435 11.4227 11.6254L11.6014 11.5431C11.7978 11.4527 11.8959 11.4075 12 11.4075C12.1041 11.4075 12.2022 11.4527 12.3986 11.5431L12.5773 11.6254C13.2682 11.9435 13.6136 12.1025 13.8435 11.9281C14.0733 11.7536 14.0352 11.3612 13.9592 10.5763L13.9395 10.3733C13.9179 10.1502 13.9071 10.0387 13.9392 9.93531C13.9714 9.83191 14.0429 9.74833 14.1858 9.58118L14.316 9.42898C14.819 8.84072 15.0706 8.54659 14.9828 8.26432C14.895 7.98205 14.526 7.89857 13.7881 7.73161L13.5972 7.68841C13.3875 7.64097 13.2827 7.61725 13.1985 7.55334C13.1143 7.48944 13.0603 7.39258 12.9524 7.19887L12.8541 7.02251C12.4741 6.34084 12.2841 6 12 6Z" class="fill-primary-500/60" />
                        <path d="M7.09301 15.9414L6.71424 17.323C6.0859 19.6148 5.77173 20.7607 6.19097 21.3881C6.3379 21.6079 6.535 21.7844 6.76372 21.9008C7.41634 22.2331 8.424 21.7081 10.4393 20.658C11.1099 20.3086 11.4452 20.1339 11.8014 20.0959C11.9335 20.0818 12.0665 20.0818 12.1986 20.0959C12.5548 20.1339 12.8901 20.3086 13.5607 20.658C15.576 21.7081 16.5837 22.2331 17.2363 21.9008C17.465 21.7844 17.6621 21.6079 17.809 21.3881C18.2283 20.7607 17.9141 19.6148 17.2858 17.323L16.907 15.9414C15.5208 16.9231 13.8278 17.5 12 17.5C10.1722 17.5 8.47915 16.9231 7.09301 15.9414Z" class="fill-primary-500/60" />
                    </svg>
                </div>
                <div>
                    <label class="text-xs text-primary-500/80">Top Performers</label>
                    <p class="text-4xl font-bold text-primary-500">{{ topPerformers }}%</p>
                </div>
            </div>

            <div class="grid grid-cols-[60px_1fr] items-center gap-6 bg-primary-50 border border-gray-300 text-gray-900 rounded-lg shadow-sm p-2.5">
                <div class="flex justify-center items-center aspect-square rounded-lg">
                    <svg class="w-[70%] fill-primary-500/60" viewBox="-1 0 19 19" xmlns="http://www.w3.org/2000/svg"><path d="M16.417 9.583A7.917 7.917 0 1 1 8.5 1.666a7.917 7.917 0 0 1 7.917 7.917zm-2.787.06a5.076 5.076 0 0 0-7.6-4.401 5.11 5.11 0 0 0-1.252 1.015V5.57a.396.396 0 0 0-.792 0v1.66a.396.396 0 0 0 .396.395H6.04a.396.396 0 0 0 0-.791h-.717A4.274 4.274 0 0 1 8.556 5.36a4.282 4.282 0 1 1-4.283 4.283.396.396 0 0 0-.792 0 5.074 5.074 0 1 0 10.15 0zm-4.763-.099V6.872a.396.396 0 0 0-.791 0v2.841a.395.395 0 0 0 .153.313l1.537 1.536a.396.396 0 1 0 .56-.56z"/></svg>
                </div>
                <div>
                    <label class="text-xs text-primary-500/80">Recent Logins</label>
                    <p class="text-4xl font-bold text-primary-500">{{ recentLogins }}</p>
                </div>
            </div>
        </section>
        <section>
            <div class="grid grid-cols-1 gap-4">
                <!-- Learner Performance Comparison -->
                <div class="card bg-primary-50">
                    <div class="mb-4">
                        <h3 class="text-lg text-gray-700 font-semibold">Individual Learner Performance</h3>
                        <p class="text-gray-500">Progress and completion status for each learner</p>
                    </div>
                    <div class="relative">
                        <canvas id="learnerPerformanceChart" #learnerPerformanceChart></canvas>
                    </div>
                </div>
            </div>
        </section>
        @if (learners.length > 0) {
            <section>
                <div id="learnerCardsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                    @for (learner of learners; track $index) {
                        <div class="card bg-primary-50">

                            <!-- Header -->
                            <div class="learner-header flex items-center gap-3 mb-4">
                                <div
                                    class="learner-avatar w-12 h-12 rounded-full bg-primary-300 text-white flex items-center justify-center font-bold text-lg">
                                    {{ getInitials(learner.learner_name) }}
                                </div>
                                <div class="learner-info">
                                    <h4 class="font-semibold">{{ learner.learner_name }}</h4>
                                    <p class="text-sm text-gray-500">{{ learner.email }}</p>
                                </div>
                            </div>

                            <!-- Stats -->
                            <div class="learner-stats flex justify-between mb-4">
                                <div class="stat-item text-center">
                                    <div class="stat-value font-bold">{{ learner.completed_courses }}/{{ learner.total_courses }}
                                    </div>
                                    <div class="stat-label text-xs text-gray-500">Completed</div>
                                </div>
                                <div class="stat-item text-center">
                                    <div class="stat-value font-bold">{{ learner.avg_score }}</div>
                                    <div class="stat-label text-xs text-gray-500">Avg Score</div>
                                </div>
                            </div>

                            <!-- Progress -->
                            <div class="progress-section mb-3">
                                <div class="progress-header flex justify-between text-sm mb-1">
                                    <span class="progress-label">Overall Progress</span>
                                    <span class="progress-percentage">
                                        {{ getProgressPercentage(learner.completed_courses, learner.total_courses) }}%
                                    </span>
                                </div>
                                <div class="progress-bar h-2 bg-gray-200 rounded">
                                    <div class="progress-fill h-2 bg-primary-500 rounded"
                                        [style.width.%]="getProgressPercentage(learner.completed_courses, learner.total_courses)">
                                    </div>
                                </div>
                            </div>

                            <!-- Last Login -->
                            <div class="last-login text-xs text-gray-400 hidden">
                                Last login: {{ formatDate(learner.last_login) }}
                            </div>
                        </div>
                    }                    
                </div>
            </section>
        }
    </div>
</div>