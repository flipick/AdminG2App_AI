<div class="grid gap-4">
    <section>
        <div class="flex items-end gap-4">
            <div class="min-w-40">
                <label class="block mb-2 text-sm text-gray-900">Department</label>
                <select class="form-select" [(ngModel)]="selectedDepartmentId"
                    (change)="filterByDepartment(selectedDepartmentId)">
                    <option value="0" selected>Select Department</option>
                    @for(department of departmentList; track $index) {
                    <option [value]="department.departmentId">
                        {{ department.departmentName }}
                    </option>
                    }
                </select>
            </div>
        </div>
    </section>
    @if(selectedDepartmentId == '0' || selectedDepartmentId == '' ) {
        <div class="card bg-primary-50">
            <h3 class="border-b-1 font-medium text-primary-500 border-primary-300/80 cursor-default pb-2 mb-2">Select a department to view detailed analytics</h3>
            <p class="text-sm text-primary-500">Choose from the dropdown above to see department-specific performance metrics, learner progress, and comparative analysis.</p>
        </div>
    }

    @if(selectedDepartmentId != '0' && selectedDepartmentId != '') {
        <div class="grid gap-4">
            <!-- Executive Summary Cards -->
            <section class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                <div class="grid grid-cols-[60px_1fr] items-center gap-6 bg-primary-50 border border-gray-300 text-gray-900 rounded-lg shadow-sm p-2.5">
                    <div class="flex justify-center items-center aspect-square rounded-lg">
                        <svg class="w-[70%] fill-primary-500/60" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512"  xml:space="preserve">
                            <g>
                                <path class="st0" d="M505.837,180.418L279.265,76.124c-7.349-3.385-15.177-5.093-23.265-5.093c-8.088,0-15.914,1.708-23.265,5.093
                                    L6.163,180.418C2.418,182.149,0,185.922,0,190.045s2.418,7.896,6.163,9.627l226.572,104.294c7.349,3.385,15.177,5.101,23.265,5.101
                                    c8.088,0,15.916-1.716,23.267-5.101l178.812-82.306v82.881c-7.096,0.8-12.63,6.84-12.63,14.138c0,6.359,4.208,11.864,10.206,13.618
                                    l-12.092,79.791h55.676l-12.09-79.791c5.996-1.754,10.204-7.259,10.204-13.618c0-7.298-5.534-13.338-12.63-14.138v-95.148
                                    l21.116-9.721c3.744-1.731,6.163-5.504,6.163-9.627S509.582,182.149,505.837,180.418z"/>
                                <path class="st0" d="M256,346.831c-11.246,0-22.143-2.391-32.386-7.104L112.793,288.71v101.638
                                    c0,22.314,67.426,50.621,143.207,50.621c75.782,0,143.209-28.308,143.209-50.621V288.71l-110.827,51.017
                                    C278.145,344.44,267.25,346.831,256,346.831z"/>
                            </g>
                        </svg>
                    </div>
                    <div>
                        <label class="text-xs text-primary-500/80">Department Learners</label>
                        <p class="text-4xl font-bold text-primary-500">{{ currentDepartment?.total_learners }}</p>
                    </div>
                </div>
                 <div class="grid grid-cols-[60px_1fr] items-center gap-6 bg-primary-50 border border-gray-300 text-gray-900 rounded-lg shadow-sm p-2.5">
                    <div class="flex justify-center items-center aspect-square rounded-lg">
                        <svg class="w-[70%] fill-primary-500/60" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" preserveAspectRatio="xMidYMid meet"><path d="M57.063 20.218l1.029-1.698s.906-1.502.906-3.519c0-4.886-4.662-4.757-4.662-4.757L44.179 7.479L38.638 2l-7.291 1.985l-2.391-.651l-1.817 1.797l-10.497 2.858s-4.04-.111-4.04 4.123c0 1.748.786 3.05.786 3.05l1.351 2.23l-1.187 1.172l-5.86 1.596s-4.662-.129-4.662 4.757a7.56 7.56 0 0 0 .779 3.281L2 29.987l.949.376c.021.051.029.108.07.149c1.835 1.839 1.684 4.309 1.422 5.643l-1.109 1.111l8.401 4.039L23.271 60.35c1.849 2.906 5.774 1.088 5.774 1.088l29.649-14.256l-1.109-1.111c-.262-1.334-.413-3.804 1.422-5.644c.041-.041.049-.098.07-.148l.949-.377l-5.513-5.45l6.33-3.043l-.961-.963c-.227-1.156-.358-3.297 1.233-4.891c.035-.036.041-.084.06-.129l.825-.327l-4.937-4.881m-5.685-8.835l-1.25 1.978l-3.234-3.198l4.484 1.22M39.176 7.144l4.643 4.963l-16.789 6.067l-3.965-6.156l16.111-4.874M15.744 19.052l11.457 18.911l-21.827-8.658l10.37-10.253m-4.775 2.067l-1.345 1.33l-.538-.825l1.883-.505m-4.247 1.034l1.252 1.927l-2.713 2.682a5.586 5.586 0 0 1-.331-1.845c0-1.826.906-2.521 1.792-2.764M5.154 37.026l.015-.058l25.147 11.007l-24.95-11.894c.023-.135.041-.284.06-.434l19.533 8.18l-19.465-9.116a7.723 7.723 0 0 0-.086-1.245l18.079 7.445L5.165 32.4a6.048 6.048 0 0 0-.47-1.137l24.883 10.625l.566.934c1.167 1.834 3.284 1.495 4.351 1.177c1.475.728 4.119 2.412 3.442 4.893c-.357 1.312-1.142 1.948-2.399 1.948c-1.273 0-2.544-.666-2.557-.675L5.154 37.026M30.2 50.185l-1.966.814l-1.67-2.563l3.636 1.749m-7.614 5.381l-7.729-12.759l7.682 3.693l3.633 5.592c-1.465.626-3.102 2.055-3.586 3.474m34.033-12.184a7.731 7.731 0 0 0-.086 1.245l-19.465 9.116l19.533-8.18c.019.149.036.299.06.434l-24.95 11.895l25.147-11.007a.982.982 0 0 1 .015.058L29.046 60.08c-.013.009-1.282.675-2.557.675c-1.258 0-2.042-.637-2.399-1.948c-.918-3.367 4.302-5.276 4.38-5.305l4.575-1.952c.491.209 3.994 1.584 5.711-1.115l1.083-1.786l17.494-7.47a6.12 6.12 0 0 0-.471 1.137L38.54 50.827l18.079-7.445m.034-4.161l-14.825 6.144l4.114-6.791l6.767-3.253l3.944 3.9m2.393-11.107a6.9 6.9 0 0 0-.075 1.079l-16.868 7.9l16.928-7.089c.017.129.031.26.052.376L37.459 40.688l21.794-9.539a.46.46 0 0 1 .013.05L35.149 42.586c-.011.007-1.112.585-2.216.585c-1.091 0-1.77-.553-2.079-1.689c-.796-2.918 3.728-4.572 3.796-4.597l25.014-10.68a5.268 5.268 0 0 0-.407.986l-15.88 7.376l15.669-6.453" class=" fill-primary-500/60"></path></svg>
                    </div>
                    <div>
                        <label class="text-xs text-primary-500/80">Courses Offered</label>
                        <p class="text-4xl font-bold text-primary-500">{{ currentDepartment?.courses_offered }}</p>
                    </div>
                </div>
                <div class="grid grid-cols-[60px_1fr] items-center gap-6 bg-primary-50 border border-gray-300 text-gray-900 rounded-lg shadow-sm p-2.5">
                    <div class="flex justify-center items-center aspect-square rounded-lg">
                        <svg class="w-[70%] fill-primary-500/60" viewBox="0 0 1920 1920" xmlns="http://www.w3.org/2000/svg">
                            <path d="M854.344 1317.685 503.209 966.55l79.85-79.85 271.285 271.285 520.207-520.32 79.849 79.962-600.056 600.057ZM960.056 0c-529.355 0-960 430.645-960 960s430.645 960 960 960c529.243 0 960-430.645 960-960S1489.3 0 960.056 0Z" />
                        </svg>
                    </div>
                    <div>
                        <label class="text-xs text-primary-500/80">Completion Rate</label>
                        <p class="text-4xl font-bold text-primary-500">{{ currentDepartment?.avg_completion_rate }}%</p>
                    </div>
                </div>
                <div class="grid grid-cols-[60px_1fr] items-center gap-6 bg-primary-50 border border-gray-300 text-gray-900 rounded-lg shadow-sm p-2.5">
                    <div class="flex justify-center items-center aspect-square rounded-lg">
                        <svg class="w-[70%] fill-primary-500/60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g id="style=fill">
                                <g id="clock-stand">
                                    <path id="line (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M17.4697 19.9697C17.7626 19.6768 18.2374 19.6768 18.5303 19.9697L20.0303 21.4697C20.3232 21.7626 20.3232 22.2374 20.0303 22.5303C19.7374 22.8232 19.2626 22.8232 18.9697 22.5303L17.4697 21.0303C17.1768 20.7374 17.1768 20.2626 17.4697 19.9697Z" class="fill-primary-500/60" />
                                    <path id="line (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M6.53033 19.9697C6.23744 19.6768 5.76256 19.6768 5.46967 19.9697L3.96967 21.4697C3.67678 21.7626 3.67678 22.2374 3.96967 22.5303C4.26256 22.8232 4.73744 22.8232 5.03033 22.5303L6.53033 21.0303C6.82322 20.7374 6.82322 20.2626 6.53033 19.9697Z" class="fill-primary-500/60" />
                                    <path id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M12 3.25C6.61779 3.25 2.25 7.61779 2.25 13C2.25 18.3822 6.61779 22.75 12 22.75C17.3822 22.75 21.75 18.3822 21.75 13C21.75 7.61779 17.3822 3.25 12 3.25ZM12.417 8.95911C12.417 8.54489 12.0812 8.20911 11.667 8.20911C11.2528 8.20911 10.917 8.54489 10.917 8.95911V12.6491C10.917 13.0941 11.0674 13.5365 11.2742 13.8993C11.4809 14.2617 11.7844 14.6155 12.1656 14.8417L12.1666 14.8423L14.9546 16.5061C15.3103 16.7184 15.7708 16.6021 15.983 16.2464C16.1953 15.8908 16.079 15.4303 15.7233 15.2181L12.9333 13.5531L12.9313 13.5519C12.827 13.4901 12.6899 13.3537 12.5772 13.1562C12.4646 12.9587 12.417 12.7712 12.417 12.6491V8.95911Z" class="fill-primary-500/60" />
                                    <path id="line (Stroke)_3" fill-rule="evenodd" clip-rule="evenodd" d="M17.4379 1.50345C17.7121 1.19304 18.1861 1.16374 18.4965 1.438L22.2434 4.74864C22.5539 5.0229 22.5832 5.49687 22.3089 5.80728C22.0346 6.11769 21.5607 6.14699 21.2503 5.87273L17.5033 2.56209C17.1929 2.28783 17.1636 1.81386 17.4379 1.50345Z" class="fill-primary-500/60" />
                                    <path id="line (Stroke)_4" fill-rule="evenodd" clip-rule="evenodd" d="M6.56203 1.50345C6.28776 1.19304 5.81379 1.16374 5.50339 1.438L1.75643 4.74864C1.44602 5.0229 1.41672 5.49687 1.69098 5.80728C1.96524 6.11769 2.43921 6.14699 2.74962 5.87273L6.49658 2.56209C6.80699 2.28783 6.83629 1.81386 6.56203 1.50345Z" class="fill-primary-500/60" />
                                </g>
                            </g>
                        </svg>
                    </div>
                    <div>
                        <label class="text-xs text-primary-500/80">Total Learning Hours</label>
                        <p class="text-4xl font-bold text-primary-500">{{ currentDepartment?.avg_score }}</p>
                    </div>
                </div>
            </section>
            
            <section>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                    <!-- Department Performance Comparison -->
                    <div class="card bg-primary-50">
                        <div class="mb-4">
                            <h3 class="text-lg text-gray-700 font-semibold">Department Performance Comparison</h3>
                            <p class="text-gray-500">Completion rates and average scores by department</p>
                        </div>
                        <div class="relative">
                            <canvas id="departmentVsOrgChart" #departmentVsOrgChart></canvas>
                        </div>
                    </div>

                    <!-- Industry Benchmarking -->
                    <div class="card bg-primary-50">
                        <div class="mb-4">
                            <h3 class="text-lg text-gray-700 font-semibold">Industry Benchmarking</h3>
                            <p class="text-gray-500">Performance comparison across industry categories</p>
                        </div>
                        <div class="relative">
                            <canvas id="learnerDistributionChart" #learnerDistributionChart></canvas>
                        </div>
                    </div>

                </div>
            </section>
        </div>
     }
</div>