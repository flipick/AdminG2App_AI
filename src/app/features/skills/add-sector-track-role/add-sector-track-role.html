<section class="grid gap-4">
  <!-- Toggle Add / Edit Form -->
  @if(!showForm) {
    <div class="flex items-center">      
      <button (click)="showAddForm()"
        class="btn-primary ml-auto">
        Add New Role
      </button>
    </div>
  }

  <!-- Form -->
  @if(showForm) {
    <section class="card">
      <div class="mb-4">
        <h3 class="text-lg text-gray-700 font-semibold">
          {{ selectedRoleId ? 'Edit Role' : 'Add New Sector / Track / Role' }}
        </h3>
      </div>

      <form #sectorForm="ngForm" (ngSubmit)="onAdd(sectorForm)">
        <div class="grid sm:grid-cols-2 md:grid-cols-4 gap-4">
          <!-- Tenant Dropdown -->
          <div>
            <label class="block mb-1 text-sm font-medium text-gray-700">
              Tenant <span class="text-red-500">*</span>
            </label>
            <select [(ngModel)]="newTenantId" name="tenant" required #tenantModel="ngModel"
              class="form-select w-full border-gray-300 rounded-lg shadow-sm focus:ring focus:ring-blue-300">
              <option value="">Select Tenant</option>
              <option *ngFor="let tenant of tenantlist" [value]="tenant.tenantId">
                {{ tenant.tenantName }}
              </option>
            </select>
            <div *ngIf="tenantModel.invalid && tenantModel.touched" class="text-red-500 text-sm mt-1">
              Tenant is required
            </div>
          </div>

          <!-- Sector -->
          <div class="relative">
            <label class="block mb-1 text-sm font-medium text-gray-700">Sector <span class="text-red-500">*</span></label>
            <input type="text" [(ngModel)]="newSector" name="sector" required #sectorModel="ngModel"
              (input)="filterSectors()" placeholder="Enter or select sector"
              class="form-input w-full border-gray-300 rounded-lg shadow-sm focus:ring focus:ring-blue-300" />
            <ul *ngIf="filteredSectors.length"
              class="absolute z-10 bg-white border border-gray-300 w-full mt-1 rounded shadow max-h-40 overflow-y-auto">
              <li *ngFor="let sector of filteredSectors" (click)="selectSector(sector)"
                class="px-3 py-1 hover:bg-blue-100 cursor-pointer">
                {{ sector }}
              </li>
            </ul>
          </div>

          <!-- Track -->
          <div class="relative">
            <label class="block mb-1 text-sm font-medium text-gray-700">Track <span class="text-red-500">*</span></label>
            <input type="text" [(ngModel)]="newTrack" name="track" required #trackModel="ngModel"
              (input)="filterTracks()" placeholder="Enter or select track"
              class="form-input w-full border-gray-300 rounded-lg shadow-sm focus:ring focus:ring-blue-300" />
            <ul *ngIf="filteredTracks.length"
              class="absolute z-10 bg-white border border-gray-300 w-full mt-1 rounded shadow max-h-40 overflow-y-auto">
              <li *ngFor="let track of filteredTracks" (click)="selectTrack(track)"
                class="px-3 py-1 hover:bg-blue-100 cursor-pointer">
                {{ track }}
              </li>
            </ul>
          </div>

          <!-- Role -->
          <div>
            <label class="block mb-1 text-sm font-medium text-gray-700">
              Role <span class="text-red-500">*</span>
            </label>
            <input type="text" [(ngModel)]="newRole" name="role" required #roleModel="ngModel"
              placeholder="Enter new role"
              class="form-input w-full border-gray-300 rounded-lg shadow-sm focus:ring focus:ring-blue-300" />
          </div>

          <!-- Job Role Description -->
          <div class="md:col-span-2">
            <label class="block mb-1 text-sm font-medium text-gray-700">Job Role Description</label>
            <textarea [(ngModel)]="jobRoleDescription" name="jobRoleDescription" rows="3"
              placeholder="Enter job role description"
              class="form-textarea"></textarea>
          </div>
        </div>

        <!-- Buttons -->
        <div class="mt-4 flex justify-end gap-3">
           <button type="button" (click)="onCancel()"
            class="btn-outline">
            Cancel
          </button>
          <button type="submit" [disabled]="sectorForm.invalid"
            class="btn-primary">
            {{ selectedRoleId ? 'Update' : 'Add' }}
          </button>
         
        </div>
        <p *ngIf="addMessage" class="mt-3 text-sm text-green-600 font-medium">{{ addMessage }}</p>
      </form>
    </section>
  }

  <!-- Grid -->
  @if(!showForm) {
    <div class="card p-0 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full border-collapse table-fixed">
            <thead class="bg-blue-100 text-gray-700 uppercase text-sm">
              <tr class="bg-primary-200 text-left text-sm text-gray-700 border-b border-primary-300/80">
                <th class="p-4 font-semibold w-15">#</th>
                <th class="p-4 font-semibold">Sector</th>
                <th class="p-4 font-semibold">Track</th>
                <th class="p-4 font-semibold">Job Role</th>
                <th class="p-4 font-semibold w-40">Actions</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let item of pagedRoles; let i = index" class="border-b  border-primary-300/80 text-sm hover:bg-primary-100">
                <td class="p-4">{{ i + 1 }}</td>
                <td class="p-4">{{ item.sector }}</td>
                <td class="p-4">{{ item.track }}</td>
                <td class="p-4">{{ item.jobRoleName }}</td>
                <td class="p-4">
                  <div class="flex items-center justify-center space-x-2">
                    <button class="btn-outline-secondary" (click)="EditRoleData(item)"> Edit </button>
                    <button class="btn-outline-secondary" (click)="DeleteRoleData(item)"> Delete </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <!-- Pagination Controls -->
      <div *ngIf="roles.length > itemsPerPage" class="flex justify-between items-center p-4 text-sm text-gray-600">
        <p>Page {{ currentPage }} of {{ totalPages }}</p>
        <div class="flex space-x-2">
          <button 
            (click)="prevPage()" 
            [disabled]="currentPage === 1"
            class="btn-outline disabled:opacity-50 disabled:cursor-not-allowed">
            Previous
          </button>
          <!-- <ng-container *ngFor="let page of [].constructor(totalPages); let idx = index">
            <button 
              (click)="goToPage(idx + 1)"
              [ngClass]="{'bg-blue-600 text-white': currentPage === idx + 1, 'bg-gray-200 text-gray-700': currentPage !== idx + 1}"
              class="px-3 py-1 rounded hover:bg-blue-500 hover:text-white transition">
              {{ idx + 1 }}
            </button>
          </ng-container> -->
          <button 
            (click)="nextPage()" 
            [disabled]="currentPage === totalPages"
            class="btn-outline disabled:opacity-50 disabled:cursor-not-allowed">
            Next
          </button>
        </div>
      </div>

        </div>
    </div>
  }
</section>


<!-- Only show popup when deleteRoleId is set -->
<app-popup #popup [config]="popupConfig" (closeEvent)="closePopup()" (buttonClick)="handlePopupAction($event)">
  <ng-container *ngIf="popupConfig.popupFunctionalityType === 'delete'">
    <app-delete-sector-track-role
      #deleteSectorTrackRole
      [roleId]="deleteRoleId"
      (close)="closePopup()"
      (deleted)="onRoleDeleted()"
    ></app-delete-sector-track-role>
  </ng-container>
</app-popup>


